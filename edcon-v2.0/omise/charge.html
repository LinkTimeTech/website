<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <script src="js/omise.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/jquery-3.1.1.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body style="background-color: #1e1e1e;">
<form action="https://edcon.io/FranceWebsite/Register/pay.php" method="post" id="checkout">
    <div class="container"
         style="background-color: #FFFFFF; width: 320px;height: 455px;margin: auto;position: absolute;left: 50%;top: 35%;margin-left: -160px;margin-top: -155px;border-radius: 5px;">
        <label style="width: 100%;text-align: center;margin-top: 15px;font-size: 16px;">EDCON</label>
        <hr style="margin-top: 10PX;"/>
        <input id="name" data-omise="holder_name" class="form-control" type="text" placeholder="CardHolder's Name"/>
        <input id="number" data-omise="number" class="form-control" style="margin-top: 10px;" type="text"
               placeholder="Card number"/>
        <input id="month" data-omise="expiration_month" class="form-control"
               style="width: 49%;display: inline-block;margin-top: 10px;" type="tel" maxlength="2"
               placeholder="MM(valid thru)" onkeyup='this.value=this.value.replace(/\D/gi,"")'/>
        <input id="year" data-omise="expiration_year" class="form-control"
               style="width: 49%;display: inline-block;margin-top: 10px;" type="tel" maxlength="4"
               placeholder="YYYY(valid thru)" onkeyup='this.value=this.value.replace(/\D/gi,"")'/>
        <div style="height: 40px;">
            <input id="cvc" data-omise="security_code" placeholder="CVC" class="form-control" type="tel"
                   style="display: inline-block;float: left; width: 25%;margin-top: 10px;"
                   onkeyup='this.value=this.value.replace(/\D/gi,"")'/>
            <div style="display: inline-block;float: left;width: 71%;font-size: 11px;margin-top: 10px;margin-left: 5px;">
                You can find the security code at the back of your card
            </div>
        </div>
        <input value="Standard Tikets = € 380.00" disabled="disabled" class="form-control" style="margin-top: 10px;"
               type="tel"/>
        <input value="VAT = € 76.00" disabled="disabled" class="form-control" style="margin-top: 10px;" type="tel"/>
        <input value="Total = € 456.00" disabled="disabled" class="form-control" style="margin-top: 10px;" type="tel"/>
        <input type="hidden" value="456" name="money"/>
        <input type="hidden" name="omise_token">
        <input type="submit" id="create_token" value="Submit"
               style="background-color: #22ABD5;width: 100%;border: none;height: 40px;margin-top: 10px;border-radius: 5px;color: #FFFFFF;"/>
        <div style="text-align: center;margin-top: 10px;">
            <a style="color: #a1aab3;text-decoration: none;" href="https://www.omise.co/" target="_blank">Secure by</a>
            <img src="img/omis.png" height="19"/>
        </div>
    </div>

</form>

<div class="modal fade bs-example-modal-sm" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Warning!</h4>
            </div>
            <div id="alert" class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">

    Omise.setPublicKey("pkey_56zzsgxpq8xytuon7fu");

    $("#checkout").submit(function () {

        var form = $(this);

        // Disable the submit button to avoid repeated click.
        form.find("input[type=submit]").prop("disabled", true);

        // Serialize the form fields into a valid card object.
        var card = {
            "name": form.find("[data-omise=holder_name]").val(),
            "number": form.find("[data-omise=number]").val(),
            "expiration_month": form.find("[data-omise=expiration_month]").val(),
            "expiration_year": form.find("[data-omise=expiration_year]").val(),
            "security_code": form.find("[data-omise=security_code]").val()
        };

        // Send a request to create a token then trigger the callback function once
        // a response is received from Omise.
        //
        // Note that the response could be an error and this needs to be handled within
        // the callback.
        Omise.createToken("card", card, function (statusCode, response) {
            if (response.object == "error" || !response.card.security_code_check) {
                // Display an error message.
                var message_text = "Please review the details and enter the valid information.";
                if (response.object == "error") {
                    message_text = response.message;
                }
//		      		$("#token_errors").html(message_text);
                document.getElementById("alert").innerText = message_text;
                $('#myModal').modal();
                // Re-enable the submit button.
                form.find("input[type=submit]").prop("disabled", false);
                console.log(response);
            } else {
                // Then fill the omise_token.
                form.find("[name=omise_token]").val(response.id);
                var mon = form.find("[name=money]").val();
                form.find("[name=money]").val(parseInt(mon.replace("€", "")));
                // Remove card number from form before submiting to server.
                form.find("[data-omise=number]").val("");
                form.find("[data-omise=security_code]").val("");


                // submit token to server.
                form.get(0).submit();
                console.log(form.get(0));
            }
        });

        // Prevent the form from being submitted;
        return false;

    });
</script>
</html>
