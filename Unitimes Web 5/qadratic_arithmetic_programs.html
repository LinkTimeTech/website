<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="always">
    <meta name="robots" content="index, follow">

    <title>
        Quadratic Arithmetic Programs: from Zero to Hero
    </title>

    <meta name="title" content="Quadratic Arithmetic Programs: from Zero to Hero">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <link rel="stylesheet" type="text/css" href="css/article-font.css">
    <link rel="stylesheet" href="css/article.css">
</head>

<body class="browser-chrome os-mac is-withMagicUnderlines v-glyph v-glyph--m2 v-enableBrandingButtons is-js postShowScreen">
<div class="site-main surface-container">
    <div class="surface">
        <div class="screenContent surface-content">
            <div class="metabar u-clearfix  u-boxShadowBottomThinLighter u-textColorDarker u-fixed u-backgroundTransparentWhiteDarkest u-xs-sizeFullViewportWidth u-tintBgColor u-tintSpectrum">
                <div class="metabar-inner u-marginAuto u-maxWidth1000 u-flexCenter u-justifyContentSpaceBetween u-paddingLeft20 u-paddingRight20 u-height65 u-xs-height56">
                    <div class="metabar-block u-flex1 u-flexCenter">
                        <a href="index.html" class="link u-flex">
                            <img src="images/icon/logo_black.svg" height="25px">
                        </a>
                    </div>
                    <div class="metabar-block u-flex0 u-flexCenter">
                        <div class="u-alignMiddle u-inlineBlock u-verticalAlignTop u-height65 u-xs-height56">
                            <div class="u-alignBlock">
                                <div class="buttonSet buttonSet--wide u-lineHeightInherit">
                                    <!--<a class="button button&#45;&#45;primary button&#45;&#45;dark button&#45;&#45;chromeless u-accentColor&#45;&#45;buttonDark is-inSiteNavBar u-xs-hide js-signInButton" href="#">-->
                                    <!--中文</a>-->
                                    <a class="button button--primary button--dark button--withChrome u-accentColor--buttonDark is-inSiteNavBar"
                                       href="qadratic_arithmetic_programs_cn.html" style="font-size: 14px">
                                        中文</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="metabar-inner u-marginAuto u-maxWidth1000">
                    <nav role="navigation" class="metabar-block metabar-block--below u-overflowHiddenY u-height40">
                        <ul class="u-textAlignLeft u-noWrap u-overflowX u-paddingBottom100 u-sm-paddingLeft20 u-sm-paddingRight20">
                            <li class="metabar-navItem u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10">
                                <a class="link link--darken u-accentColor--textDarken  "
                                   href="unitalks.html"> Unitalks </a></li>
                            <li class="metabar-navItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10">
                                <a class="link link--darken u-accentColor--textDarken link--noUnderline "
                                   href="news.html"> News </a></li>
                            <li class="metabar-navItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10">
                                <a class="link link--darker link--darken u-accentColor--textDarken link--noUnderline "
                                   href="knowledge.html"> Knowledge </a></li>
                            <li class="metabar-navItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10">
                                <a class="link link--darken u-accentColor--textDarken link--noUnderline "
                                   href="events.html"> Events </a></li>
                            <span class="u-borderLeft1 u-paddingLeft22 u-xs-paddingLeft12 u-baseColor--borderLight"></span>
                            <li class="metabar-navItem  is-external u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10">
                                <a class="link link--darken u-accentColor--textDarken link--noUnderline "
                                   href="index.html"> Home </a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="metabar metabar--spacer u-tintBgColor u-height105 u-xs-height95"></div>
            <main role="main">
                <article
                        class="u-minHeight100vhOffset65 u-overflowHidden postArticle postArticle--full is-withAccentColors"
                        lang="en" data-scroll="native">
                    <header class="container u-maxWidth740">
                        <div class="uiScale uiScale-ui--regular uiScale-caption--regular postMetaHeader u-paddingBottom10 row">
                            <div class="col u-size12of12">
                                <div class="uiScale uiScale-ui--regular uiScale-caption--regular postMetaLockup postMetaLockup--authorWithBio u-flexCenter">
                                    <div class="u-flex0">
                                        <!--<a class="link avatar u-baseColor&#45;&#45;link ui-linkSubtle" href="#">-->
                                        <img src="images/knowledge/vitalik-Buterin.jpeg" width="50px" height="50px"
                                             class="avatar-image">
                                        <!--</a>-->
                                    </div>
                                    <div class="u-flex1 u-paddingLeft15 u-overflowHidden">
                                        <div class="u-lineHeightTightest">
                                            Vitalik Buterin
                                        </div>
                                        <div class="ui-caption postMetaInline">
                                            <time>10 April, 2017</time>
                                            <!--<span class="middotDivider u-fontSize12"></span>-->
                                            <!--<span class="readingTime"title="3 min read"></span>-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>
                    <div class="postArticle-content" data-scroll="native">
                        <section class="section section--body section--first">
                            <div class="section-content">
                                <div class="section-inner sectionLayout--insetColumn">
                                    <h1 class="graf graf--h3 graf--leading graf--title">Quadratic
                                        Arithmetic Programs: from Zero to&nbsp;Hero</h1>

                                    <img class="graf--p graf-image u-marginTop40" src="images/knowledge/z2-thumb.jpg"
                                         width="100%">

                                    <p class="graf graf--p graf-after--p">There has been a lot of
                                        interest lately in the technology behind zk-SNARKs, and people are increasingly
                                        <a href="https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/">trying to
                                            demystify</a>
                                        something that many have come to call
                                        “moon math” due to its perceived sheer indecipherable complexity. zk-SNARKs are
                                        indeed quite challenging to grasp, especially due to the sheer number of moving
                                        parts that need to come together for the whole thing to work, but if we break
                                        the technology down piece by piece then comprehending it becomes simpler.</p>
                                    <p class="graf graf--p graf-after--p">The purpose of this post
                                        is not to serve as a full introduction to zk-SNARKs; it assumes as background
                                        knowledge that (i) you know what zk-SNARKs are and what they do, and (ii) know
                                        enough math to be able to reason about things like polynomials (if the statement<code
                                                class="markup--code markup--p-code">P(x) + Q(x) = (P + Q)(x)</code>&nbsp;,
                                        where <code class="markup--code markup--p-code">P </code>and <code
                                                class="markup--code markup--p-code">Q</code> are polynomials, seems
                                        natural and obvious to you, then you’re at the right level). Rather, the post
                                        digs deeper into the machinery behind the technology, and tries to explain as
                                        well as possible the first half of the pipeline, as drawn by zk-SNARK researcher
                                        Eran Tromer here:</p>
                                    <img class="graf--p graf-image"
                                         src="images/knowledge/1-YD-ckgBfmmmRBCyVlhp8YQ(1).png" width="50%">

                                    <p class="graf graf--p graf-after--figure">The steps here can
                                        be broken up into two halves. First, zk-SNARKs cannot be applied to any
                                        computational problem directly; rather, you have to convert the problem into the
                                        right “form” for the problem to operate on. The form is called a “quadratic
                                        arithmetic program” (QAP), and transforming the code of a function into one of
                                        these is itself highly nontrivial. Along with the process for converting the
                                        code of a function into a QAP is another process that can be run alongside so
                                        that if you have an input to the code you can create a corresponding solution
                                        (sometimes called “witness” to the QAP). After this, there is another fairly
                                        intricate process for creating the actual “zero knowledge proof” for this
                                        witness, and a separate process for verifying a proof that someone else passes
                                        along to you, but these are details that are out of scope for this post.</p>
                                    <p class="graf graf--p graf-after--p">The example that we will
                                        choose is a simple one: proving that you know the solution to a cubic equation:
                                        x**3 + x + 5 == 35 (hint: the answer is 3). This problem is simple enough that
                                        the resulting QAP will not be so large as to be intimidating, but nontrivial
                                        enough that you can see all of the machinery come into play.</p>
                                    <p class="graf graf--p graf-after--p">Let us write out our
                                        function as follows:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">def qeval(x):<br>    y = x**3<br>    return x + y + 5</code></pre>
                                    <p class="graf graf--p graf-after--pre">The simple
                                        special-purpose programming language that we are using here supports basic
                                        arithmetic (+, -, *, /), constant-power exponentiation (x**7 but not x**y) and
                                        variable assignment, which is powerful enough that you can theoretically do any
                                        computation inside of it (as long as the number of computational steps is
                                        bounded; no loops allowed). Note that modulo (%) and comparison operators (&lt;,
                                        &gt;, ≤, ≥) are NOT supported, as there is no efficient way to do modulo or
                                        comparison directly in finite cyclic group arithmetic (be thankful for this; if
                                        there was a way to do either one, then elliptic curve cryptography would be
                                        broken faster than you can say “binary search” and “Chinese remainder
                                        theorem”).</p>
                                    <p class="graf graf--p graf-after--p">You can extend the
                                        language to modulo and comparisons by providing bit decompositions (eg. 13 =
                                        2**3 + 2**2 + 1) as auxiliary
                                        inputs, proving correctness of those decompositions and doing the math in binary
                                        circuits; in finite field arithmetic, doing equality (==) checks is also doable
                                        and in fact a bit easier, but these are both details we won’t get into right
                                        now. We can extend the language to support conditionals (eg. <code
                                                class="markup--code markup--p-code">if x &lt; 5: y = 7; else: y =
                                            9</code>) by converting them to an arithmetic form: <code
                                                class="markup--code markup--p-code">y = 7 * (x &lt; 5) + 9 * (x &gt;=
                                            5)</code>; though note that both “paths” of the conditional would need to be
                                        executed, and if you have many nested conditionals then this can lead to a large
                                        amount of overhead.</p>
                                    <p class="graf graf--p graf-after--p">Let us now go through
                                        this process step by step. If you want to do this yourself for any piece of
                                        code, I <a href="https://github.com/ethereum/research/tree/master/zksnark">implemented
                                            a compiler here</a> (for educational
                                        purposes only; not ready for making QAPs for real-world zk-SNARKs quite yet!).
                                    </p>
                                    <h3 class="graf graf--h3 graf-after--p">Flattening</h3>
                                    <p class="graf graf--p graf-after--h3">The first step is a
                                        “flattening” procedure, where we convert the original code, which may contain
                                        arbitrarily complex statements and expressions, into a sequence of statements
                                        that are of two forms:<code class="markup--code markup--p-code">x = y</code>
                                        (where <code class="markup--code markup--p-code">y</code> can be a variable or a
                                        number)and <code class="markup--code markup--p-code">x = y (op) z</code> (where
                                        <code class="markup--code markup--p-code">op</code> can be +, -, *, / and <code
                                                class="markup--code markup--p-code">y</code> and <code
                                                class="markup--code markup--p-code">z</code> can be variables, numbers
                                        or themselves sub-expressions). You can think of each of these statements as
                                        being kind of like logic gates in a circuit. The result of the flattening
                                        process for the above code is as follows:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">sym_1 = x * x<br>y = sym_1 * x<br>sym_2 = y + x<br>~out = sym_2 + 5</code></pre>
                                    <p class="graf graf--p graf-after--pre">If you read the
                                        original code and the code here, you can fairly easily see that the two are
                                        equivalent.</p>
                                    <h3 class="graf graf--h3 graf-after--p">Gates
                                        to&nbsp;R1CS</h3>
                                    <p class="graf graf--p graf-after--h3">Now, we convert this
                                        into something called a rank-1 constraint system (R1CS). An R1CS is a sequence
                                        of groups of three vectors <code class="markup--code markup--p-code">(a, b,
                                            c)</code>, and the solution to an R1CS is a vector <code
                                                class="markup--code markup--p-code">s</code>, where <code
                                                class="markup--code markup--p-code">s</code> must satisfy the equation
                                        <code class="markup--code markup--p-code">s&nbsp;. a * s&nbsp;. b - s&nbsp;. c =
                                            0</code>, where&nbsp;<code class="markup--code markup--p-code">.</code>
                                        represents the dot product - in simpler terms, if we "zip together" <code
                                                class="markup--code markup--p-code">a</code> and <code
                                                class="markup--code markup--p-code">s</code>, multiplying the two values
                                        in the same positions, and then take the sum of these products, then do the same
                                        to <code class="markup--code markup--p-code">b</code> and <code
                                                class="markup--code markup--p-code">s</code> and then <code
                                                class="markup--code markup--p-code">c</code> and <code
                                                class="markup--code markup--p-code">s</code>, then the third result
                                        equals the product of the first two results. For example, this is a satisfied
                                        R1CS:</p>
                                    <img class="graf--p graf-image"
                                         src="images/knowledge/1-wp6bmXoPEU_zZHzJFRq6IQ(1).png" width="50%">

                                    <p class="graf graf--p graf-after--figure">But instead of
                                        having just one constraint, we are going to have many constraints: one for each
                                        logic gate. There is a standard way of converting a logic gate into a <code
                                                class="markup--code markup--p-code">(a, b, c)</code> triple depending on
                                        what the operation is (+, -, * or /) and whether the arguments are variables or
                                        numbers. The length of each vector is equal to the total number of variables in
                                        the system, including a dummy variable<code class="markup--code markup--p-code">~one</code>
                                        at the first index representing the number 1, the input variables, a dummy
                                        variable <code class="markup--code markup--p-code">~out</code> representing the
                                        output, and then all of the intermediate variables (<code
                                                class="markup--code markup--p-code">sym1</code> and <code
                                                class="markup--code markup--p-code">sym2</code> above); the vectors are
                                        generally going to be very sparse, only filling in the slots corresponding to
                                        the variables that are affected by some particular logic gate.</p>
                                    <p class="graf graf--p graf-after--p">First, we’ll provide the
                                        variable mapping that we’ll use:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">'~one', 'x', '~out', 'sym_1', 'y', 'sym_2'</code></pre>
                                    <p class="graf graf--p graf-after--pre">The solution vector
                                        will consist of assignments for all of these variables, in that order.</p>
                                    <p class="graf graf--p graf-after--p">Now, we’ll give the
                                        <code class="markup--code markup--p-code">(a, b, c)</code> triple for the first
                                        gate:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">a = [0, 1, 0, 0, 0, 0]<br>b = [0, 1, 0, 0, 0, 0]<br>c = [0, 0, 0, 1, 0, 0]</code></pre>
                                    <p class="graf graf--p graf-after--pre">You can see that if
                                        the solution vector contains 3 in the second position, and 9 in the fourth
                                        position, then regardless of the rest of the contents of the solution vector,
                                        the dot product check will boil down to 3 * 3 = 9, and so it will pass. If the
                                        solution vector has -3 in the second position and 9 in the fourth position, the
                                        check will also pass; in fact, if the solution vector has 7 in the second
                                        position and 49 in the fourth position then that check will still pass — the
                                        purpose of this first check is to verify the consistency of the inputs and
                                        outputs of the first gate only.</p>
                                    <p class="graf graf--p graf-after--p">Now, let’s go on to the
                                        second gate:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">a = [0, 0, 0, 1, 0, 0]<br>b = [0, 1, 0, 0, 0, 0]<br>c = [0, 0, 0, 0, 1, 0]</code></pre>
                                    <p class="graf graf--p graf-after--pre">In a similar style to
                                        the first dot product check, here we’re checking that <code
                                                class="markup--code markup--p-code">sym_1 * x = y</code>.</p>
                                    <p class="graf graf--p graf-after--p">Now, the third gate:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">a = [0, 1, 0, 0, 1, 0]<br>b = [1, 0, 0, 0, 0, 0]<br>c = [0, 0, 0, 0, 0, 1]</code></pre>
                                    <p class="graf graf--p graf-after--pre">Here, the pattern is
                                        somewhat different: it’s multiplying the first element in the solution vector by
                                        the second element, then by the fifth element, adding the two results, and
                                        checking if the sum equals the sixth element. Because the first element in the
                                        solution vector is always one, this is just an addition check, checking that the
                                        output equals the sum of the two inputs.</p>
                                    <p class="graf graf--p graf-after--p">Finally, the fourth
                                        gate:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">a = [5, 0, 0, 0, 0, 1]<br>b = [1, 0, 0, 0, 0, 0]<br>c = [0, 0, 1, 0, 0, 0]</code></pre>
                                    <p class="graf graf--p graf-after--pre">Here, we’re evaluating
                                        the last check, <code class="markup--code markup--p-code">~out = sym_2 +
                                            5</code>. The dot product check works by taking the sixth element in the
                                        solution vector, adding five times the first element (reminder: the first
                                        element is 1, so this effectively means adding 5), and checking it against the
                                        third element, which is where we store the output variable.</p>
                                    <p class="graf graf--p graf-after--p">And there we have our
                                        R1CS with four constraints. The witness is simply the assignment to all the
                                        variables, including input, output and internal variables:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">[1, 3, 35, 9, 27, 30]</code></pre>
                                    <p class="graf graf--p graf-after--pre">You can compute this
                                        for yourself by simply “executing” the flattened code above, starting off with
                                        the input variable assignment x=3, and putting in the values of all the
                                        intermediate variables and the output as you compute them.</p>
                                    <p class="graf graf--p graf-after--p">The complete R1CS put
                                        together is:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">A<br>[0, 1, 0, 0, 0, 0]<br>[0, 0, 0, 1, 0, 0]<br>[0, 1, 0, 0, 1, 0]<br>[5, 0, 0, 0, 0, 1]</code></pre>
                                    <pre class="graf graf--pre graf-after--pre"><code
                                            class="markup--code markup--pre-code">B<br>[0, 1, 0, 0, 0, 0]<br>[0, 1, 0, 0, 0, 0]<br>[1, 0, 0, 0, 0, 0]<br>[1, 0, 0, 0, 0, 0]</code></pre>
                                    <pre class="graf graf--pre graf-after--pre"><code
                                            class="markup--code markup--pre-code">C<br>[0, 0, 0, 1, 0, 0]<br>[0, 0, 0, 0, 1, 0]<br>[0, 0, 0, 0, 0, 1]<br>[0, 0, 1, 0, 0, 0]</code></pre>
                                    <h3 class="graf graf--h3 graf-after--pre">R1CS
                                        to&nbsp;QAP</h3>
                                    <p class="graf graf--p graf-after--h3">The next step is taking
                                        this R1CS and converting it into QAP form, which implements the exact same logic
                                        except using polynomials instead of dot products. We do this as follows. We go
                                        from four groups of three vectors of length six to six groups of three degree-3
                                        polynomials, where evaluating the polynomials at each <em
                                                class="markup--em markup--p-em">x coordinate</em> represents one of the
                                        constraints. That is, if we evaluate the polynomials at x=1, then we get our
                                        first set of vectors, if we evaluate the polynomials at x=2, then we get our
                                        second set of vectors, and so on.</p>
                                    <p class="graf graf--p graf-after--p">We can make this
                                        transformation using something called a <em class="markup--em markup--p-em">Lagrange
                                            interpolation</em>. The problem that a Lagrange interpolation solves is
                                        this: if you have a set of points (ie. (x, y) coordinate pairs), then doing a
                                        Lagrange interpolation on those points gives you a polynomial that passes
                                        through all of those points. We do this by decomposing the problem: for each x
                                        coordinate, we create a polynomial that has the desired y coordinate at that x
                                        coordinate and a y coordinate of 0 at all the other x coordinates we are
                                        interested in, and then to get the final result we add all of the polynomials
                                        together.</p>
                                    <p class="graf graf--p graf-after--p">Let’s do an example.
                                        Suppose that we want a polynomial that passes through (1, 3), (2, 2) and (3, 4).
                                        We start off by making a polynomial that passes through (1, 3), (2, 0) and (3,
                                        0). As it turns out, making a polynomial that “sticks out” at x=1 and is zero at
                                        the other points of interest is easy; we simply do:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">(x - 2) * (x - 3)</code></pre>
                                    <p class="graf graf--p graf-after--pre">Which looks like
                                        this:</p>
                                    <img class="graf--p graf-image"
                                         src="images/knowledge/1-wsBN9VA71EXm2L4EV-hwcw(1).png" width="50%">

                                    <p class="graf graf--p graf-after--figure">Now, we just need
                                        to “rescale” it so that the height at x=1 is right:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">(x - 2) * (x - 3) * 3 / ((1 - 2) * (1 - 3))</code></pre>
                                    <p class="graf graf--p graf-after--pre">This gives us:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">1.5 * x**2 - 7.5 * x + 9</code></pre>

                                    <img class="graf--p graf-image"
                                         src="images/knowledge/1-8agIwBEX5YJ1HyZ4K5r5Gw(1).png" width="50%">

                                    <p class="graf graf--p graf-after--figure">We then do the same
                                        with the other two points, and get two other similar-looking polynomials, except
                                        that they “stick out” at x=2 and x=3 instead of x=1. We add all three together
                                        and get:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">1.5 * x**2 - 5.5 * x + 7</code></pre>

                                    <img class="graf--p graf-image"
                                         src="images/knowledge/1-kAn6O2BcDOsMgSwRPvRfZA(1).png" width="50%">

                                    <p class="graf graf--p graf-after--figure">With exactly the
                                        coordinates that we want. The algorithm as described above takes O(n**3) time,
                                        as there are n points and each point requires O(n**2) time to multiply the
                                        polynomials together; with a little thinking, this can be reduced to O(n**2)
                                        time, and with a lot more thinking, using fast Fourier transform algorithms and
                                        the like, it can be reduced even further — a crucial optimization when functions
                                        that get used in zk-SNARKs in practice often have many thousands of gates.</p>
                                    <p class="graf graf--p graf-after--p">Now, let’s use Lagrange
                                        interpolation to transform our R1CS. What we are going to do is take the first
                                        value out of every <code class="markup--code markup--p-code">a</code> vector,
                                        use Lagrange interpolation to make a polynomial out of that (where evaluating
                                        the polynomial at <code class="markup--code markup--p-code">i</code> gets you
                                        the first value of the ith <code class="markup--code markup--p-code">a</code>
                                        vector), repeat the process for the first value of every <code
                                                class="markup--code markup--p-code">b</code> and <code
                                                class="markup--code markup--p-code">c</code> vector, and then repeat
                                        that process for the second values, the third, values, and so on. For
                                        convenience I'll provide the answers right now:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">A polynomials<br>[-5.0, 9.166, -5.0, 0.833]<br>[8.0, -11.333, 5.0, -0.666]<br>[0.0, 0.0, 0.0, 0.0]<br>[-6.0, 9.5, -4.0, 0.5]<br>[4.0, -7.0, 3.5, -0.5]<br>[-1.0, 1.833, -1.0, 0.166]</code></pre>
                                    <pre class="graf graf--pre graf-after--pre"><code
                                            class="markup--code markup--pre-code">B polynomials<br>[3.0, -5.166, 2.5, -0.333]<br>[-2.0, 5.166, -2.5, 0.333]<br>[0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0]</code></pre>
                                    <pre class="graf graf--pre graf-after--pre"><code
                                            class="markup--code markup--pre-code">C polynomials<br>[0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0]<br>[-1.0, 1.833, -1.0, 0.166]<br>[4.0, -4.333, 1.5, -0.166]<br>[-6.0, 9.5, -4.0, 0.5]<br>[4.0, -7.0, 3.5, -0.5]</code></pre>
                                    <p class="graf graf--p graf-after--pre">Coefficients are in
                                        ascending order, so the first polynomial above is actually <code
                                                class="markup--code markup--p-code">0.833 * x**3 — 5*x**2 + 9.166*x -
                                            5</code>. This set of polynomials (plus a Z polynomial that I will explain
                                        later) makes up the parameters for this particular QAP instance. Note that all
                                        of the work up until this point needs to be done only once for every function
                                        that you are trying to use zk-SNARKs to verify; once the QAP parameters are
                                        generated, they can be reused.</p>
                                    <p class="graf graf--p graf-after--p">Let’s try evaluating all
                                        of these polynomials at x=1. Evaluating a polynomial at x=1 simply means adding
                                        up all the coefficients (as 1**k = 1 for all k), so it’s not difficult. We
                                        get:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">A results at x=1<br>0<br>1<br>0<br>0<br>0<br>0</code></pre>
                                    <pre class="graf graf--pre graf-after--pre"><code
                                            class="markup--code markup--pre-code">B results at x=1<br>0<br>1<br>0<br>0<br>0<br>0</code></pre>
                                    <pre class="graf graf--pre graf-after--pre"><code
                                            class="markup--code markup--pre-code">C results at x=1<br>0<br>0<br>0<br>1<br>0<br>0</code></pre>
                                    <p class="graf graf--p graf-after--pre">And lo and behold,
                                        what we have here is exactly the same as the set of three vectors for the first
                                        logic gate that we created above.</p>
                                    <h3 class="graf graf--h3 graf-after--p">Checking
                                        the&nbsp;QAP</h3>
                                    <p class="graf graf--p graf-after--h3">Now what’s the point of
                                        this crazy transformation? The answer is that instead of checking the
                                        constraints in the R1CS individually, we can now check <em
                                                class="markup--em markup--p-em">all of the constraints at the same
                                            time</em> by doing the dot product check <em
                                                class="markup--em markup--p-em">on the polynomials</em>.</p>

                                    <img class="graf--p graf-image"
                                         src="images/knowledge/1-QD2EfVsbNguEXrjKJwNVMg(1).png" width="50%">

                                    <p class="graf graf--p graf-after--figure">Because in this
                                        case the dot product check is a series of additions and multiplications of
                                        polynomials, the result is itself going to be a polynomial. If the resulting
                                        polynomial, evaluated at every x coordinate that we used above to represent a
                                        logic gate, is equal to zero, then that means that all of the checks pass; if
                                        the resulting polynomial evaluated at at least one of the x coordinate
                                        representing a logic gate gives a nonzero value, then that means that the values
                                        going into and out of that logic gate are inconsistent (ie. the gate is <code
                                                class="markup--code markup--p-code">y = x * sym_1</code> but the
                                        provided values might be <code class="markup--code markup--p-code">x = 2</code>,<code
                                                class="markup--code markup--p-code">sym_1 = 2</code> and <code
                                                class="markup--code markup--p-code">y = 5</code>).</p>
                                    <p class="graf graf--p graf-after--p">Note that the resulting
                                        polynomial does not itself have to be zero, and in fact in most cases won’t be;
                                        it could have any behavior at the points that don’t correspond to any logic
                                        gates, as long as the result is zero at all the points that <em
                                                class="markup--em markup--p-em">do</em> correspond to some gate. To
                                        check correctness, we don’t actually evaluate the polynomial <code
                                                class="markup--code markup--p-code">t = A&nbsp;. s * B&nbsp;. s - C&nbsp;.
                                            s</code> at every point corresponding to a gate; instead, we divide <code
                                                class="markup--code markup--p-code">t</code> by another polynomial,
                                        <code class="markup--code markup--p-code">Z</code>, and check that <code
                                                class="markup--code markup--p-code">Z</code> evenly divides <code
                                                class="markup--code markup--p-code">t</code> - that is, the division
                                        <code class="markup--code markup--p-code">t / Z</code> leaves no remainder.</p>
                                    <p class="graf graf--p graf-after--p">Z is defined as <code
                                            class="markup--code markup--p-code">(x - 1) * (x - 2) * (x -
                                        3)&nbsp;...</code> - the simplest polynomial that is equal to zero at all points
                                        that correspond to logic gates. It is an elementary fact of algebra that <em
                                                class="markup--em markup--p-em">any</em> polynomial that is equal to
                                        zero at all of these points has to be a multiple of this minimal polynomial, and
                                        if a polynomial is a multiple of Z then its evaluation at any of those points
                                        will be zero; this equivalence makes our job much easier.</p>
                                    <p class="graf graf--p graf-after--p">Now, let’s actually do
                                        the dot product check with the polynomials above. First, the intermediate
                                        polynomials:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">A . s = [43.0, -73.333, 38.5, -5.166]<br>B . s = [-3.0, 10.333, -5.0, 0.666]<br>C . s = [-41.0, 71.666, -24.5, 2.833]</code></pre>
                                    <p class="graf graf--p graf-after--pre">Now, A&nbsp;. s * B&nbsp;.
                                        s — C&nbsp;. s:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">t = [-88.0, 592.666, -1063.777, 805.833, -294.777, 51.5, -3.444]</code></pre>
                                    <p class="graf graf--p graf-after--pre">Now, the minimal
                                        polynomial <code class="markup--code markup--p-code">Z = (x - 1) * (x - 2) * (x
                                            - 3) * (x - 4)</code>:</p>
                                    <pre class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">Z = [24, -50, 35, -10, 1]</code></pre>
                                    <p class="graf graf--p graf-after--pre">And if we divide the
                                        result above by Z, we get:</p>
                                    <pre name="61ba" id="61ba" class="graf graf--pre graf-after--p"><code
                                            class="markup--code markup--pre-code">h = t / Z = [-3.666, 17.055, -3.444]</code></pre>
                                    <p class="graf graf--p graf-after--pre">With no remainder.</p>
                                    <p class="graf graf--p graf-after--p">And so we have the
                                        solution for the QAP. If we try to falsify any of the variables in the R1CS
                                        solution that we are deriving this QAP solution from — say, set the last one to
                                        31 instead of 30, then we get a <code
                                                class="markup--code markup--p-code">t</code> polynomial that fails one
                                        of the checks (in that particular case, the result at x=3 would equal -1 instead
                                        of 0), and furthermore <code class="markup--code markup--p-code">t</code> would
                                        not be a multiple of Z; rather, dividing <code
                                                class="markup--code markup--p-code">t / Z</code> would give a remainder
                                        of <code class="markup--code markup--p-code">[-5.0, 8.833, -4.5, 0.666]</code>.
                                    </p>
                                    <p class="graf graf--p graf-after--p">Note that the above is a
                                        simplification; “in the real world”, the addition, multiplication, subtraction
                                        and division will happen not with regular numbers, but rather with finite field
                                        elements — a spooky kind of arithmetic which is self-consistent, so all the
                                        algebraic laws we know and love still hold true, but where all answers are
                                        elements of some finite-sized set, usually integers within the range from 0 to
                                        n-1 for some n. For example, if n = 13, then 1 / 2 = 7 (and 7 * 2 = 1), 3 * 5 =
                                        2, and so forth. Using finite field arithmetic removes the need to worry about
                                        rounding errors and allows the system to work nicely with elliptic curves, which
                                        end up being necessary for the rest of the zk-SNARK machinery that makes the
                                        zk-SNARK protocol actually secure.</p>
                                    <p class="graf graf--p graf-after--p graf--trailing">Special
                                        thanks to Eran Tromer for helping to explain many details about the inner
                                        workings of zk-SNARKs to me.</p>
                                    <p class="graf graf--p graf-after--p">
                                        Source：<a
                                            href="https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649 ">https://medium.com/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649 </a>
                                    </p>
                                </div>
                            </div>
                        </section>
                        <!--<section name="5e3a"class="section section&#45;&#45;body section&#45;&#45;last"></section>-->
                    </div>
                    <footer class="u-paddingTop30">
                        <div class="streamItem streamItem--placementCardGrid">
                            <div class="u-clearfix u-backgroundGrayLightest">
                                <div class="row u-marginAuto u-maxWidth1000 u-paddingTop30 u-paddingBottom20">

                                    <div class="col u-padding8 u-xs-size12of12 u-size4of12">
                                        <div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-sizeFullWidth u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4"
                                             data-scroll="native">
                                            <a class="link link--noUnderline "
                                               href="an_update_on_Integrating.html">
                                                <div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-sizeFullWidth u-borderBottomLight u-borderRadiusTop4"
                                                     style="background-image: url('images/knowledge/z5-thumb.jpg');"></div>
                                            </a>
                                            <div class="u-padding15 u-borderBox u-flexColumn u-height180">
                                                <a class="link link--noUnderline u-flex1 "
                                                   href="an_update_on_Integrating.html">
                                                    <div class="ui-caption postMetaInline u-noWrapWithEllipsis u-marginBottom7">
                                                        Knowledge
                                                    </div>
                                                    <div class="ui-heading ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">
                                                        An Update on Integrating Zcash on Ethereum (ZoE)
                                                    </div>
                                                </a>
                                                <div class="u-paddingTop10 u-flex0 u-flexCenter">
                                                    <div class="u-flex1 u-minWidth0 u-marginRight10">
                                                        <div class="u-flexCenter">
                                                            <div class="postMetaInline-avatar u-flex0">
                                                                <!--<a class="link avatar u-baseColor&#45;&#45;link ui-linkSubtle" href="#">-->
                                                                <img src="images/knowledge/Christian-Reitwiessner.jpeg"
                                                                     class="avatar-image u-size36x36 u-xs-size32x32">
                                                                <!--</a>-->
                                                            </div>
                                                            <div class="postMetaInline postMetaInline-authorLockup u-flex1 u-noWrapWithEllipsis">
                                                                <!--<a class="link link link&#45;&#45;darken link&#45;&#45;darker u-baseColor&#45;&#45;link ui-linkSubtle" href="#">-->
                                                                Christian Reitwiessner
                                                                <!--</a>-->
                                                                <div class="u-fontSize12 u-baseColor--textNormal u-textColorNormal">
                                                                    <time>9 Mar, 2017</time>
                                                                    <!--<span class="readingTime u-textColorNormal" title="1 min read"></span>-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col u-padding8 u-xs-size12of12 u-size4of12">
                                        <div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-sizeFullWidth u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4"
                                             data-scroll="native"><a
                                                class="link link--noUnderline "
                                                href="ethereum_erc-20_token_standard.html">
                                            <div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-sizeFullWidth u-borderBottomLight u-borderRadiusTop4"
                                                 style="background-image: url('images/news/w4-thumb.jpg');"></div>
                                        </a>
                                            <div class="u-padding15 u-borderBox u-flexColumn u-height180"><a
                                                    class="link link--noUnderline u-flex1 "
                                                    href="ethereum_erc-20_token_standard.html">
                                                <div class="ui-caption postMetaInline u-noWrapWithEllipsis u-marginBottom7">
                                                    News
                                                </div>
                                                <div class="ui-heading ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">
                                                    Ethereum's ERC-20 Token Standard Has Been Finalized
                                                </div>
                                            </a>
                                                <div class="u-paddingTop10 u-flex0 u-flexCenter">
                                                    <div class="u-flex1 u-minWidth0 u-marginRight10">
                                                        <div class="u-flexCenter">
                                                            <div class="postMetaInline-avatar u-flex0">
                                                                <!--<a class="link avatar u-baseColor&#45;&#45;link ui-linkSubtle" href="#">-->
                                                                <img src="images/dog.jpg"
                                                                     class="avatar-image u-size36x36 u-xs-size32x32">
                                                                <!--</a>-->
                                                            </div>
                                                            <div class="postMetaInline postMetaInline-authorLockup u-flex1 u-noWrapWithEllipsis">
                                                                <!--<a class="link link link&#45;&#45;darken link&#45;&#45;darker u-baseColor&#45;&#45;link ui-linkSubtle" href="#">-->
                                                                Qianxi
                                                                <!--</a>-->
                                                                <div class="u-fontSize12 u-baseColor--textNormal u-textColorNormal">
                                                                    <time>11 Sept, 2017</time>
                                                                    <!--<span class="readingTime u-textColorNormal" title="1 min read"></span>-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col u-padding8 u-xs-size12of12 u-size4of12">
                                        <div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-sizeFullWidth u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4"
                                             data-scroll="native">
                                            <a class="link link--noUnderline "
                                               href="explaining_the_ethereum_namespace_auction.html">
                                                <div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-sizeFullWidth u-borderBottomLight u-borderRadiusTop4"
                                                     style="background-image: url('images/knowledge/information_technology_767x400.jpg');"></div>
                                            </a>
                                            <div class="u-padding15 u-borderBox u-flexColumn u-height180">
                                                <a class="link link--noUnderline u-flex1 "
                                                   href="explaining_the_ethereum_namespace_auction.html">
                                                    <div class="ui-caption postMetaInline u-noWrapWithEllipsis u-marginBottom7">
                                                        Knowledge
                                                    </div>
                                                    <div class="ui-heading ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">
                                                        Explaining the Ethereum Namespace Auction
                                                    </div>
                                                </a>
                                                <div class="u-paddingTop10 u-flex0 u-flexCenter">
                                                    <div class="u-flex1 u-minWidth0 u-marginRight10">
                                                        <div class="u-flexCenter">
                                                            <div class="postMetaInline-avatar u-flex0">
                                                                <!--<a class="link avatar u-baseColor&#45;&#45;link ui-linkSubtle" href="#">-->
                                                                <img src="images/knowledge/1-AW1mbHWcIh7sSOj4XJboOw(2).jpeg"
                                                                     class="avatar-image u-size36x36 u-xs-size32x32">
                                                                <!--</a>-->
                                                            </div>
                                                            <div class="postMetaInline postMetaInline-authorLockup u-flex1 u-noWrapWithEllipsis">
                                                                <!--<a class="link link link&#45;&#45;darken link&#45;&#45;darker u-baseColor&#45;&#45;link ui-linkSubtle" href="#">-->
                                                                Maurelian
                                                                <!--</a>-->
                                                                <div class="u-fontSize12 u-baseColor--textNormal u-textColorNormal">
                                                                    <time>25 Oct, 2017</time>
                                                                    <!--<span class="readingTime u-textColorNormal" title="1 min read"></span>-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="u-textAlignCenter u-paddingBottom20 u-xs-fontSize10">&copy; UNITIMES. All
                                    Rights Reserved.
                                </div>
                            </div>
                        </div>
                    </footer>

                </article>
            </main>
        </div>
    </div>
</div>
<div class="surface-scrollOverlay"></div>
</body>

</html>